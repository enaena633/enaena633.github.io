<head>
    <!-- Load d3 source scripts -->
    <script src="https://d3js.org/d3.v4.min.js" type="text/JavaScript"></script>
    <script src="https://d3js.org/colorbrewer.v1.min.js"></script>
  </head>
  
  <body>
    <div id="covid"></div>
  </body>
  
  <script>
    const margin = { top: 20, right: 20, bottom: 30, left: 30 };
    const width = 460 - margin.left - margin.right;
    const height = 400 - margin.top - margin.bottom;
  
    // append the svg object to the body of the page
    const svg = d3
      .select("#covid")
      .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
  
    d3.csv("clean_data_total_cases.csv", function (data) {
      const sumstat = d3
        .nest() // nest function allows to group the calculation per level of a factor
        .key(function (d) {
          return d.location;
        })
        .entries(data);
  
      const x = d3
        .scaleTime()
        .domain(
          d3.extent(data, function (d) {
            return new Date(d.date);
          })
        )
        .range([0, width]);
      svg
        .append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).ticks(5));
  
      // Add Y axis
      const y = d3
        .scaleLinear()
        .domain([
          0,
          d3.max(data, function (d) {
            return Number(parseFloat(d.total_cases).toFixed(20));
          }),
        ])
        .range([height, 0]);
      svg.append("g").call(d3.axisLeft(y));
  
      // color palette
      var res = sumstat.map(function (d) {
        return d.key;
      }); // list of group names
      var color = d3
        .scaleOrdinal()
        .domain(res)
        .range([
          "#e41a1c",
          "#377eb8",
          "#4daf4a",
          "#984ea3",
          "#ff7f00",
          "#ffff33",
          "#a65628",
          "#f781bf",
        ]);
  
      // Draw the line
      svg
        .selectAll(".line")
        .data(sumstat)
        .enter()
        .append("path")
        .attr("fill", "none")
        .attr("stroke", function (d) {
          return color(d.key);
        })
        .attr("stroke-width", 1.5)
        .attr("d", function (d) {
          console.log(d);
          return d3
            .line()
            .x(function (d) {
              return x(new Date(d.date));
            })
            .y(function (d) {
              return y(Number(parseFloat(d.total_cases).toFixed(20)));
            })(d.values);
        });
    });
  </script>
  