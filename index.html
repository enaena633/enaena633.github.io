<head>

<!-- Load d3 source scripts -->
  <script src="https://d3js.org/d3.v4.min.js" type="text/JavaScript"></script> 
  <script src="https://d3js.org/colorbrewer.v1.min.js"></script>

<!-- style section-->
  <style>
     .axis path{
         stroke:black;
         stroke-width:2px ;
     }   

     .axis line{
         stroke: black;
         stroke-width: 1.5px;
     } 
  
     .axis text{
         fill: black;
         font-weight: bold;
         font-size: 14px;
         font-family:"Arial Black", Gadget, sans-serif;
     } 

     .legend text{
         fill:  black;
         font-family:"Arial Black", Gadget, sans-serif;
     }
  </style>
  
</head>

<script>

<body>
<!-- svg canvas-->
  <svg width="1200" height="750" style="background-image: url('https://etc.usf.edu/presentations/backgrounds/grid/grid_04/1304m.gif');">
  </svg>
</body>

d3.csv("clean_data_total_cases.csv", function(data){

//use .nest()function to group data so the line can be computed for each group
var sumstat = d3.nest() 
    .key(d => d.location)
    .entries(data);

console.log(sumstat)

//set color pallete for different vairables
var locationName = sumstat.map(d => d.key) 
var color = d3.scaleOrdinal().domain(locationName).range(colorbrewer.Set2[6])

//select path - three types: curveBasis,curveStep, curveCardinal
d3.select("svg")
    .selectAll(".line")
    .append("g")
    .attr("class", "line")
    .data(sumstat)
    .enter()
    .append("path")
    .attr("d", function (d) {
        return d3.line()
            .x(d => xScale(d.date))
            .y(d => yScale(d.total_cases)).curve(d3.curveCardinal)
            (d.values)
    })
    .attr("fill", "none")
    .attr("stroke", d => color(d.key))
    .attr("stroke-width", 2)


//append circle 
d3.select("svg")
    .selectAll("circle")
    .append("g")
    .data(data)
    .enter()
    .append("circle")
    .attr("r", 6)
    .attr("cx", d => xScale(d.date))
    .attr("cy", d => yScale(d.total_cases))
    .style("fill", d => color(d.location))

//append legends
var legend = d3.select("svg")
    .selectAll('g.legend')
    .data(sumstat)
    .enter()
    .append("g")
    .attr("class", "legend");

legend.append("circle")
    .attr("cx", 1000)
    .attr('cy', (d, i) => i * 30 + 350)
    .attr("r", 6)
    .style("fill", d => color(d.key))

legend.append("text")
    .attr("x", 1020)
    .attr("y", (d, i) => i * 30 + 355)
    .text(d => d.key)

//append title
d3.select("svg")
    .append("text")
    .attr("x", 485)
    .attr("y", 30)
    .attr("text-anchor", "middle")
    .text("US Total location Ad total_cases, by location, 2016-2022")
    .style("fill", "black")
    .style("font-size", 28)
    .style("font-family", "Arial Black")

//apend source
d3.select("svg")
    .append("text")
    .attr("x", 70)
    .attr("y", 700)
    .text("Source: eMarketer, March 2018")
    .style("fill", "black")
    .style("font-size", 14)
    .style("font-family", "Arial Black")
})

</script>
